{"version":3,"file":"word.js","sources":["store/word.js"],"sourcesContent":["/*\r\n * @Author: dongyuanwai yuanwaidong@gmail.com\r\n * @Date: 2025-02-16 22:12:38\r\n * @LastEditors: dongyuanwai yuanwaidong@gmail.com\r\n * @LastEditTime: 2025-02-18 22:08:08\r\n * @FilePath: \\words-flash-uniapp\\store\\word.js\r\n * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\nimport { defineStore } from 'pinia'\r\n\r\n/**\r\n * @typedef {Object} Word\r\n * @property {string} initial\r\n * @property {string} mean\r\n * @property {string} phonetic_symbol\r\n * @property {string} word\r\n * @property {string[]} word_syllable_list\r\n */\r\n\r\nexport const useWordStore = defineStore('word', {\r\n  state: () => ({\r\n    /** @type {Word[]} */\r\n    words: [],\r\n    currentIndex: 0,\r\n    isShowingChinese: false,\r\n    audioContext: null // 添加音频上下文实例\r\n  }),\r\n\r\n  getters: {\r\n    currentWord: (state) => state.words[state.currentIndex] || null,\r\n    totalWords: (state) => state.words.length\r\n  },\r\n\r\n  actions: {\r\n    /**\r\n     * @param {Word[]} words\r\n     */\r\n    initializeWords(words) {\r\n      this.words = words\r\n      // 从本地存储获取上次的进度\r\n      const savedIndex = uni.getStorageSync('currentWordIndex')\r\n      this.currentIndex = savedIndex ? parseInt(savedIndex) : 0\r\n    },\r\n\r\n    /**\r\n     * 保存当前进度到本地存储\r\n     */\r\n    saveProgress() {\r\n      uni.setStorageSync('currentWordIndex', this.currentIndex.toString())\r\n    },\r\n\r\n    toggleChinese() {\r\n      this.isShowingChinese = !this.isShowingChinese\r\n    },\r\n\r\n    nextWord() {\r\n      if (this.currentIndex < this.words.length - 1) {\r\n        this.currentIndex++\r\n        this.isShowingChinese = false\r\n        this.saveProgress() // 保存进度\r\n      }\r\n    },\r\n\r\n    previousWord() {\r\n      if (this.currentIndex > 0) {\r\n        this.currentIndex--\r\n        this.isShowingChinese = false\r\n        this.saveProgress() // 保存进度\r\n      }\r\n    },\r\n\r\n    markCurrentWordAsLearned() {\r\n      if (this.currentWord) {\r\n        this.currentWord.learned = true\r\n      }\r\n    },\r\n\r\n    resetProgress() {\r\n      this.words.forEach(word => word.learned = false)\r\n      this.currentIndex = 0\r\n      this.isShowingChinese = false\r\n      this.saveProgress() // 保存进度\r\n    },\r\n\r\n    /**\r\n     * 播放当前单词的音频\r\n     */\r\n    playCurrentWordAudio() {\r\n      if (this.currentWord) {\r\n        // 如果已经存在音频实例且正在播放，先停止\r\n        if (this.audioContext) {\r\n          this.audioContext.stop()\r\n          this.audioContext.destroy()\r\n          this.audioContext = null\r\n        }\r\n\r\n        // 创建新的音频实例\r\n        this.audioContext = uni.createInnerAudioContext()\r\n        this.audioContext.src = `https://dict.youdao.com/dictvoice?audio=${this.currentWord.word}&type=2`\r\n        \r\n        // 监听播放错误\r\n        this.audioContext.onError((res) => {\r\n          console.error('音频播放失败：', res.errMsg)\r\n          uni.showToast({\r\n            title: '音频播放失败',\r\n            icon: 'none'\r\n          })\r\n          // 清理错误的音频实例\r\n          if (this.audioContext) {\r\n            this.audioContext.destroy()\r\n            this.audioContext = null\r\n          }\r\n        })\r\n\r\n        // 开始播放\r\n        this.audioContext.play()\r\n      }\r\n    },\r\n\r\n    // 组件卸载时清理音频实例\r\n    cleanupAudio() {\r\n      if (this.audioContext) {\r\n        this.audioContext.stop()\r\n        this.audioContext.destroy()\r\n        this.audioContext = null\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 从本地加载单词列表\r\n     */\r\n    async loadWordsFromPublic() {\r\n      try {\r\n        const data = await import('@/static/A.json')\r\n        this.initializeWords(data.default)\r\n      } catch (error) {\r\n        console.error('加载单词列表失败：', error)\r\n        uni.showToast({\r\n          title: '加载单词列表失败',\r\n          icon: 'none'\r\n        })\r\n        \r\n        // 出错时使用默认数据\r\n        const defaultWords = [{\r\n          initial: \"A\",\r\n          mean: \"vt.丢弃;放弃，抛弃\",\r\n          phonetic_symbol: \"/ə'bændən/\",\r\n          word: \"abandon\",\r\n          word_syllable_list: [\"a\", \"ban\", \"don\"]\r\n        }]\r\n        this.initializeWords(defaultWords)\r\n      }\r\n    }\r\n  }\r\n}) "],"names":["defineStore","uni"],"mappings":"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"}